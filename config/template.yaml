# =========================
# 1. åŸºç¡€ç¯å¢ƒè®¾ç½® (æœåŠ¡å™¨å®‰å…¨é»˜è®¤)
# =========================
mixed-port: 7890
socks-port: 7891
tproxy-port: 7893

# [å®‰å…¨å…³é”®] æœåŠ¡å™¨é»˜è®¤ä¸å¯¹å¤–å¼€æ”¾ä»£ç†ç«¯å£
allow-lan: false
bind-address: "127.0.0.1"

ipv6: false
log-level: info
mode: rule

# [å®‰å…¨å…³é”®] é¢æ¿ä»…æœ¬æœºè®¿é—®ï¼ˆæ¨èç”¨ SSH éš§é“è¿œç¨‹ï¼‰
external-controller: 127.0.0.1:9090
external-ui: "ui"
secret: "CHANGE_ME_TO_A_STRONG_SECRET"

# =========================
# 2. DNS è®¾ç½®ï¼ˆæœåŠ¡å™¨é»˜è®¤ä»…æœ¬æœºï¼‰
# =========================
dns:
  enable: true
  listen: 127.0.0.1:1053
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://dns.google/dns-query
    - https://1.1.1.1/dns-query
  direct-nameserver:
    - 223.5.5.5
    - 119.29.29.29

# =========================
# 3. èŠ‚ç‚¹æå–å™¨ï¼ˆè®¢é˜…ï¼‰
# =========================
proxy-providers:
  UserSub:
    type: http
    # â–¼â–¼â–¼ è„šæœ¬é”šç‚¹ï¼Œè¯·å‹¿ä¿®æ”¹ä¸‹ä¸€è¡Œ â–¼â–¼â–¼
    url: "INSERT_LINK_HERE" # [SUBLINK]
    path: ./sub/usersub.yaml
    interval: 3600
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

# =========================
# 4. è§„åˆ™é›†ï¼ˆRULE-SET ä¾èµ–å®ƒï¼‰
# =========================
rule-providers:
  # --- å¹¿å‘Š/è¿‡æ»¤ ---
  ADBlock:
    type: http
    behavior: domain
    format: mrs
    interval: 86400
    url: https://adrules.top/adrules-mihomo.mrs
    path: ./ruleset/ADBlock.mrs

  AdditionalFilter:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/AdditionalFilter.list
    path: ./ruleset/AdditionalFilter.list

  SogouInput:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://ruleset.skk.moe/Clash/non_ip/sogouinput.txt
    path: ./ruleset/SogouInput.txt

  # --- é™æ€/CDN ---
  StaticResources:
    type: http
    behavior: domain
    format: text
    interval: 86400
    url: https://ruleset.skk.moe/Clash/domainset/cdn.txt
    path: ./ruleset/StaticResources.txt

  CDNResources:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://ruleset.skk.moe/Clash/non_ip/cdn.txt
    path: ./ruleset/CDNResources.txt

  AdditionalCDNResources:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/AdditionalCDNResources.list
    path: ./ruleset/AdditionalCDNResources.list

  # --- ä¸“é¡¹ ---
  EHentai:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/EHentai.list
    path: ./ruleset/EHentai.list

  TikTok:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/TikTok.list
    path: ./ruleset/TikTok.list

  SteamFix:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/SteamFix.list
    path: ./ruleset/SteamFix.list

  GoogleFCM:
    type: http
    behavior: classical
    format: text
    interval: 86400
    url: https://gcore.jsdelivr.net/gh/powerfullz/override-rules@master/ruleset/FirebaseCloudMessaging.list
    path: ./ruleset/GoogleFCM.list

  # --- å›½å†…å‡ºå£ï¼šCN åŸŸå/CN IPï¼ˆç”¨äºâ€œå›½å†…ä¹Ÿä»£ç†â€ï¼‰---
  cn_domain:
    type: http
    behavior: domain
    format: mrs
    interval: 86400
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/cn.mrs"
    path: ./ruleset/cn_domain.mrs

  cn_ip:
    type: http
    behavior: ipcidr
    format: mrs
    interval: 86400
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geoip/cn.mrs"
    path: ./ruleset/cn_ip.mrs

  geolocation-!cn:
    type: http
    behavior: domain
    format: mrs
    interval: 86400
    url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/geolocation-!cn.mrs"
    path: ./ruleset/geolocation-!cn.mrs

# =========================
# 5. ç­–ç•¥ç»„ï¼ˆä¸é‡å¤ + å›½å†…å‡ºå£ï¼‰
# =========================
proxy-groups:
  # --- æ ¸å¿ƒï¼šä¸»æ‰‹åŠ¨é€‰æ‹© ---
  - name: ğŸš€ èŠ‚ç‚¹é€‰æ‹©
    type: select
    use:
      - UserSub

  # --- æ ¸å¿ƒï¼šä¸»è‡ªåŠ¨ä¼˜é€‰ ---
  - name: âš¡ è‡ªåŠ¨ä¼˜é€‰
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - UserSub

  # --- å›½å†…å‡ºå£ï¼ˆèŠ‚ç‚¹å‘½åå¸¦å›½æ——ï¼šğŸ‡¨ğŸ‡³ï¼‰---
  - name: ğŸ‡¨ğŸ‡³ å›½å†…è‡ªåŠ¨ä¼˜é€‰
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50
    use:
      - UserSub
    # å‘½åå« ğŸ‡¨ğŸ‡³ æˆ– â€œå›å›½/å¤§é™†/å†…åœ°/CN2/ä¸­è½¬â€ç­‰ä¼šè¢«ç­›å…¥
    filter: "(ğŸ‡¨ğŸ‡³|å›å›½|ä¸­å›½|å¤§é™†|å†…åœ°|CN2|ä¸­è½¬|BGP|\\bCT\\b|\\bCU\\b|\\bCM\\b|\\bCN\\b|China)"

  - name: ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
    type: select
    proxies:
      - ğŸ‡¨ğŸ‡³ å›½å†…è‡ªåŠ¨ä¼˜é€‰
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub
    filter: "(ğŸ‡¨ğŸ‡³|å›å›½|ä¸­å›½|å¤§é™†|å†…åœ°|CN2|ä¸­è½¬|BGP|\\bCT\\b|\\bCU\\b|\\bCM\\b|\\bCN\\b|China)"

  # --- ç‹¬ç«‹åº”ç”¨åˆ†ç»„ ---
  - name: ğŸ“¹ YouTube
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸµ Spotify
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸ’³ PayPal
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
    use:
      - UserSub

  - name: ğŸ¤– AI & Copilot
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸ“º å…¶ä»–æµåª’ä½“
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸ’° è™šæ‹Ÿè´§å¸
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
    use:
      - UserSub

  - name: ğŸ“² ç”µæŠ¥æ¶ˆæ¯
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  # --- ä½ è¦çš„æ–°å¢åˆ†ç»„ ---
  - name: å¹¿å‘Šæ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - REJECT-DROP
      - DIRECT

  - name: æœç‹—è¾“å…¥
    type: select
    proxies:
      - REJECT-DROP
      - DIRECT

  - name: Truth Social
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: é™æ€èµ„æº
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT

  - name: E-Hentai
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: TikTok
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: Steamä¿®å¤
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: Playå•†åº—ä¿®å¤
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: FCMæ¨é€
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
    use:
      - UserSub

  - name: æ–°æµªå¾®åš
    type: select
    proxies:
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
    use:
      - UserSub

  - name: ğŸ Apple
    type: select
    proxies:
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸ¦ Twitter(X)
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
    use:
      - UserSub

  - name: ğŸ“¦ PikPak
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸš„ Speedtest
    type: select
    proxies:
      - DIRECT
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
    use:
      - UserSub

  - name: ğŸ§‘â€ğŸ’» å¼€å‘è€…èµ„æº
    type: select
    proxies:
      - DIRECT
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
    use:
      - UserSub

  - name: ğŸ“š å­¦æœ¯èµ„æº
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
    use:
      - UserSub

  - name: ğŸ® æ¸¸æˆå¹³å°
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
    use:
      - UserSub

  - name: ğŸ´ å·´å“ˆå§†ç‰¹
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - DIRECT
    use:
      - UserSub

  - name: ğŸ“º å“”å“©å“”å“©
    type: select
    proxies:
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - DIRECT
    use:
      - UserSub

  # --- å…œåº• ---
  - name: ğŸŸ æ¼ç½‘ä¹‹é±¼
    type: select
    proxies:
      - ğŸš€ èŠ‚ç‚¹é€‰æ‹©
      - âš¡ è‡ªåŠ¨ä¼˜é€‰
      - ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
    use:
      - UserSub

# =========================
# 6. åˆ†æµè§„åˆ™ï¼ˆå»æ‰å›½å†…ç›´è¿ï¼šCN å…¨èµ° ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£ï¼‰
# =========================
rules:
  # --- é˜²è‡ªç¯/ç®¡ç†å£ç›´è¿ ---
  - DST-PORT,22,DIRECT
  - DST-PORT,9090,DIRECT
  - DST-PORT,7890,DIRECT
  - DST-PORT,7891,DIRECT
  - DST-PORT,7893,DIRECT

  # --- ç§ç½‘æ°¸è¿œç›´è¿ï¼ˆæœåŠ¡å™¨/ç½‘å…³éƒ½å¿…é¡»ç•™ï¼‰---
  - GEOIP,private,DIRECT

  # --- å¹¿å‘Š/è¿‡æ»¤ ---
  - RULE-SET,ADBlock,å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,AdditionalFilter,å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,SogouInput,æœç‹—è¾“å…¥

  # --- é™æ€/CDN ---
  - RULE-SET,StaticResources,é™æ€èµ„æº
  - RULE-SET,CDNResources,é™æ€èµ„æº
  - RULE-SET,AdditionalCDNResources,é™æ€èµ„æº

  # --- Truth Social ---
  - DOMAIN-SUFFIX,truthsocial.com,Truth Social

  # --- ä¸“é¡¹/ä¿®å¤ ---
  - RULE-SET,EHentai,E-Hentai
  - RULE-SET,TikTok,TikTok
  - RULE-SET,SteamFix,Steamä¿®å¤
  - RULE-SET,GoogleFCM,FCMæ¨é€
  - DOMAIN,services.googleapis.cn,Playå•†åº—ä¿®å¤

  # --- AIï¼ˆç”¨ GeoSite æ›´ç¨³ï¼Œè¦†ç›– OpenAI/Claude/Gemini ç­‰ï¼‰---
  - GEOSITE,category-ai-!cn,ğŸ¤– AI & Copilot
  - GEOSITE,openai,ğŸ¤– AI & Copilot
  - GEOSITE,anthropic,ğŸ¤– AI & Copilot
  - GEOSITE,google-gemini,ğŸ¤– AI & Copilot
  - GEOSITE,github,ğŸ¤– AI & Copilot

  # --- ç¤¾åª’/å·¥å…· ---
  - GEOSITE,weibo,æ–°æµªå¾®åš
  - GEOSITE,twitter,ğŸ¦ Twitter(X)
  - GEOSITE,apple,ğŸ Apple
  - GEOSITE,pikpak,ğŸ“¦ PikPak
  - GEOSITE,ookla-speedtest,ğŸš„ Speedtest
  - GEOSITE,bahamut,ğŸ´ å·´å“ˆå§†ç‰¹
  - GEOSITE,bilibili,ğŸ“º å“”å“©å“”å“©

  # --- ç”µæŠ¥ ---
  - GEOSITE,telegram,ğŸ“² ç”µæŠ¥æ¶ˆæ¯
  - GEOIP,telegram,ğŸ“² ç”µæŠ¥æ¶ˆæ¯

  # --- YouTube / Spotify / PayPal / æµåª’ä½“ ---
  - GEOSITE,youtube,ğŸ“¹ YouTube
  - GEOSITE,spotify,ğŸµ Spotify
  - GEOSITE,paypal,ğŸ’³ PayPal
  - GEOSITE,netflix,ğŸ“º å…¶ä»–æµåª’ä½“
  - GEOSITE,disney,ğŸ“º å…¶ä»–æµåª’ä½“
  - GEOSITE,hbo,ğŸ“º å…¶ä»–æµåª’ä½“
  - GEOSITE,category-porn,ğŸ“º å…¶ä»–æµåª’ä½“

  # --- Dev / Scholar / Games / Crypto ---
  - GEOSITE,category-dev,ğŸ§‘â€ğŸ’» å¼€å‘è€…èµ„æº
  - GEOSITE,category-scholar-!cn,ğŸ“š å­¦æœ¯èµ„æº
  - GEOSITE,category-games,ğŸ® æ¸¸æˆå¹³å°
  - GEOSITE,category-cryptocurrency,ğŸ’° è™šæ‹Ÿè´§å¸
  - GEOSITE,binance,ğŸ’° è™šæ‹Ÿè´§å¸
  - GEOSITE,okx,ğŸ’° è™šæ‹Ÿè´§å¸

  # --- Google / Microsoft ---
  - GEOSITE,google,ğŸš€ èŠ‚ç‚¹é€‰æ‹©
  - GEOSITE,microsoft,ğŸš€ èŠ‚ç‚¹é€‰æ‹©

  # =========================
  # å›½å†…æµé‡ï¼šä¸ç›´è¿ï¼Œå…¨éƒ¨èµ° ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
  # =========================
  - RULE-SET,cn_domain,ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£
  - RULE-SET,cn_ip,ğŸ‡¨ğŸ‡³ å›½å†…å‡ºå£

  # --- å…œåº• ---
  - RULE-SET,geolocation-!cn,ğŸŸ æ¼ç½‘ä¹‹é±¼
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
